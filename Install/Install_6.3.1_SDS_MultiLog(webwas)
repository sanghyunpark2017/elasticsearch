
#filebeat에는 여러 모듈이 있음
cd /etc/filebeat/module.d

filebeat modules list

filebeat modules enable apache2
#filebeat modules disable apache2

filebeat modules list

ll  /etc/filebeat/module.d

vi /etc/filebeat/module.d/apache2.yml
-------------------------------------------------------------------------
- module: apache2
  access:
    enabled: true
    var.paths: ["/logs/weblog/dev.reach.access*.log"]
  
  error:
    enabled: true
    var.paths: ["/logs/weblog/error*.log"]
-------------------------------------------------------------------------

########## 그러나 여기서는 filebeat 모듈 사용하지는 않음 


#개요 
-filebeat는 아파치로그 2개(평문, SSL), WAS로그 1개 등 여러 로그 마다 type를 구분지어서 logstash로 보낸다.
-logstash는 type별로 (if~elseif~) 처리한다.

###########################################
Logstash설정
###########################################

vi /etc/logstash/conf.d/logstash-pipeline-5555.conf
-----------------------------------------------------------
input { 
  beats { 
    port => "5555" 
  } 
} 


filter {
  if [type] == "mywaslog" {
    mutate {
      remove_field => [ "beat", "offset", "source" ]
    }
    grok {
      match => { "message" => "%{TIMESTAMP_ISO8601:apptimestamp} .*" }
    }
    date {
      match => ["apptimestamp", "yyyy:MM:DD HH:mm:ss"]
    }
  }
  else if [type] == "myweblog" {
    mutate {
      remove_field => [ "beat", "offset", "source" ]
    }
    grok {
      match => { "message" => "%{TIMESTAMP_ISO8601:apptimestamp} .*" }
    }
    date {
      match => ["apptimestamp", "yyyy:MM:DD HH:mm:ss"]
    }
  }

}


output {
  if [type] == "mywaslog" 
  {
    elasticsearch { hosts => "http://10.10.62.103:9200"
    index => "filebeat-test-waslog" }
  }
  else if [type] == "myweblog"
  {
    elasticsearch { hosts => "http://10.10.62.103:9200"
    index => "filebeat-test-weblog" }
  }
}
-----------------------------------------------------------


###########################################
Filebeat설정
###########################################
vi /etc/filebeat/filebeat.yml
------------------------------------------------------
filebeat:
  prospectors:
  - input_type: log
    fields_under_root: true
    fields:
      type: mywaslog
    encoding: utf-8
    ignore_older: 24h
    scan_frequency: 5s
    clean_inactive: 48h  
    clean_removed: true
    paths:
      - /logs/waslog/sds_api_T1CSDSAPIDEV01.log
    multiline.pattern: '^[[0-9]{4}-[0-9]{2}-[0-9]{2}'
    multiline.negate: true
    multiline.match: after
    multiline.timeout: 5s
  - input_type: log
    fields_under_root: true
    fields:
      type: myweblog
    encoding: utf-8
#    ignore_older: 24h
    scan_frequency: 5s
#    clean_inactive: 48h  
#    clean_removed: true
    paths:
      - /logs/weblog/ssl_dev.reach.access*.log



filebeat.config.modules:
  path: ${path.config}/modules.d/*.yml
  reload.enabled: false

setup.template.settings:
  index.number_of_shards: 3

setup.kibana:

output.logstash:
  hosts:
  - 10.10.62.103:5555
  
  
  
  
  
  
  
  
  
  
  


